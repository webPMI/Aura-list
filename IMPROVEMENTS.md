# AuraList - Improvement Roadmap

> Generated by /init orchestration analysis — 5 specialized agents, 2026-02-17

---

## Quick Wins

Small changes with high user impact. Each can be implemented in a single focused session.

### ~~UX-1: Undo on Task Deletion~~ ✅ COMPLETADO (2026-02-15)
**Files changed:** `lib/widgets/task_tile.dart`, `lib/providers/task_provider.dart`
**Implemented:** After confirming deletion, a floating SnackBar appears for 5 seconds with a "Deshacer" button. Tapping it calls `restoreTask()` which re-saves locally and re-syncs to cloud.

### ~~WB-1: Grace Days for Streaks~~ ✅ COMPLETADO (2026-02-15)
**Files changed:** `lib/providers/streak_provider.dart`, `lib/screens/dashboard_screen.dart`
**Implemented:** 2 grace days/month. When user misses exactly 1 day and has grace days remaining, a dialog appears on the Dashboard offering to preserve the streak. Monthly auto-reset of grace day count.

### ~~A11Y-1: Semantic Labels on Icon Buttons~~ ✅ COMPLETADO (2026-02-15)
**Files changed:** `lib/screens/home_screen.dart`, `lib/widgets/navigation/adaptive_navigation.dart`, `lib/screens/notes_screen.dart`
**Implemented:** Moved sync button tooltip from outer `Tooltip` wrapper to `IconButton.tooltip` for proper semantic button labeling. Added `tooltip: 'Más opciones'` to `PopupMenuButton`. Wrapped decorative `Icon(Icons.check_circle_outline)` in NavigationRail with `ExcludeSemantics`. Added `tooltip: 'Limpiar búsqueda'` to notes search clear button. All other icon buttons were already correctly labelled.

### ~~CODE-1: Log Silent Failures in Achievement System~~ ✅ COMPLETADO (2026-02-15)
**File changed:** `lib/widgets/task_tile.dart`
**Implemented:** Added `import '../services/logger_service.dart'` and replaced all 4 silent failure points with `LoggerService().error(tag, msg, error: e, stack: stack)` calls: `_checkAndShowStreakCelebration`, `_checkAndShowAchievements`, `_incrementGuideAffinity`, and the undo-restore catch block. UX remains uninterrupted; errors now surface in logs with full stack traces for diagnosis.

### ~~UX-4: Undo for Task Completion Toggle~~ ✅ COMPLETADO (2026-02-17)
**File changed:** `lib/widgets/task_tile.dart`
**Implemented:** Extracted `_performToggle()` method consolidating both swipe-right and checkbox handlers. After any toggle, a floating SnackBar appears for 5 seconds with "Deshacer". The undo action calls `updateTask(task.copyWith(isCompleted: wasCompleted))` to restore the exact pre-toggle state (safer than a second `toggleTask` call). Daily task history record is also reversed on undo. Celebrations still fire only on completion, not on undo. Duplicate toggle logic removed from two call sites.

### UX-5: Swipe Gesture Affordance (First-Use Hint)
**Files:** `lib/widgets/task_tile.dart`
**What:** Show a one-time tooltip/hint on the first task tile ("← Eliminar / Completar →") for new users. Store shown state in SharedPreferences. Add subtle drag-handle visual indicator on task edges.
**Why:** Swipe right (complete) and swipe left (delete) are implemented but not discoverable. Agent found zero visual affordance cue at `task_tile.dart:356-415`.
**Use /implement UX-5**

### A11Y-5: Semantic Labels for Celebration Overlay
**Files:** `lib/widgets/shared/celebration_overlay.dart`
**What:** Wrap the `Positioned.fill` overlay in `Semantics(label: 'Tarea completada exitosamente', liveRegion: true)`. Add `SemanticsService.announce()` for screen readers.
**Why:** The CelebrationOverlay uses `IgnorePointer` with no semantic info (`celebration_overlay.dart:94`). Screen reader users get no feedback when a task is completed.
**Use /implement A11Y-5**

### ~~CODE-3: Fix StreakProvider Initialization Race Condition~~ ✅ COMPLETADO (2026-02-17)
**Files changed:** `lib/providers/streak_provider.dart`, `lib/screens/dashboard_screen.dart`
**Implemented:** Added `final Completer<void> _initCompleter` field to `StreakNotifier`. Wrapped `_loadStreak()` body in `try/finally` so the completer always signals completion even if loading throws. Exposed `ensureInitialized()` method returning `_initCompleter.future`. Replaced the fragile `await Future.delayed(const Duration(milliseconds: 500))` in `DashboardScreen._checkGraceDayOffer()` with `await ref.read(streakProvider.notifier).ensureInitialized()` — now deterministic, not timing-dependent.

### CODE-4: Extend `_deleteAndSync` Mixin to Notes Notifiers
**Files:** `lib/providers/notes_provider.dart`
**What:** The `_NoteSyncMixin` covers save/sync but not deletes. Three notifiers repeat identical try/catch delete logic (lines 183-204, 236-257, 329-350). Add `_deleteAndSync()` to the mixin and replace all three implementations.
**Why:** Code-2 already extracted saves. Deletes still have 3 copies of the same error handler. One bug fix requires 3 edits.
**Use /implement CODE-4**

---

## Medium Effort

Features requiring a few hours to a day. High value for daily users.

### ~~UX-2: Smart Task Filter Bar~~ ✅ COMPLETADO (2026-02-15)
**File changed:** `lib/widgets/task_list.dart`
**Implemented:** Horizontal scrollable row of 4 FilterChips (Todas / Alta / Pendientes / Urgentes) with live count badges. Chips stack with AND logic. Filters are local state (no provider needed). Distinct empty state when no tasks match the active filter. Hidden during search mode.

### ~~UX-3: Quick Edit via Long-Press~~ ✅ COMPLETADO (2026-02-15)
**File changed:** `lib/widgets/task_tile.dart`
**Implemented:** Added `_showQuickEditSheet(context, ref)` method and wired it to `ListTile.onLongPress`. A modal bottom sheet slides up with: 3 priority `ChoiceChip`s (Baja/Media/Alta, current one highlighted in its priority colour), 5 category chips (current highlighted in primary colour), and a full-width "Marcar como completada/pendiente" `FilledButton`. Each action pops the sheet and calls `updateTask`/`toggleTask` with `onFeedback` confirmation. `HapticFeedback.selectionClick()` on trigger.

### ~~PROD-1: Focus Mode / Today View~~ ✅ COMPLETADO (2026-02-15)
**Files changed:** `lib/screens/today_screen.dart` (new), `lib/widgets/navigation/app_drawer.dart`, `lib/screens/dashboard_screen.dart`
**Implemented:** New `TodayScreen` watches `todaySmartTasksProvider` to aggregate all tasks due today across every type. Tasks sorted: incomplete first (overdue → urgent → priority desc), completed last. Real-time `_TodayProgressHeader` shows X/Y counter + `LinearProgressIndicator`. Accessible via a "Modo Enfoque" tile in the drawer and a `_FocusModeCard` on the dashboard (shows pending count). Uses `Navigator.push` to avoid AppRoute index conflicts.

### ~~CODE-2: Extract Notes Save+Sync Pattern~~ ✅ COMPLETADO (2026-02-15)
**File changed:** `lib/providers/notes_provider.dart`
**Implemented:** Added `_NoteSyncMixin` with a single `_saveAndSync(note, {errorMessage, userMessage})` method. All three notifiers (`IndependentNotesNotifier`, `ArchivedNotesNotifier`, `TaskNotesNotifier`) now use `with _NoteSyncMixin` and 8 repeated try/catch save+sync blocks were replaced with calls to `_saveAndSync`. The mixin declares abstract getters for `_db`, `_auth`, `_errorHandler` satisfied by each class's existing fields.

### ~~UX-6: Progressive Disclosure in Task Creation Form~~ ✅ COMPLETADO (2026-02-17)
**File changed:** `lib/widgets/dialogs/add_task_dialog.dart`
**Implemented:** Required fields (type chips, recurrence day when applicable, title, priority, category) are always visible. Five optional fields (due date, due time, motivation, reward, deadline) are collapsed under an `ExpansionTile` labeled "Más opciones". A pill badge on the collapsed header shows how many advanced fields are currently filled (updates reactively via `setState`). The `ExpansionTile` is wrapped in a `Theme(data: ..copyWith(dividerColor: Colors.transparent))` to suppress its built-in horizontal dividers. Due time picker only appears when a due date is set.

### UX-7: Skeleton Loading States
**Files:** `lib/screens/today_screen.dart`, `lib/widgets/task_list.dart`
**What:** Replace `CircularProgressIndicator` with shimmer-style skeleton tiles that mirror the final task list layout. Show contextual label ("Cargando tareas de hoy...") on loading.
**Why:** Agent found blank `CircularProgressIndicator` with no context at `today_screen.dart:45-49`. Sudden content appearance feels jarring on slower devices; skeleton loading improves perceived performance.
**Use /implement UX-7**

### WB-2: Mindful Completion Pause
**Files:** `lib/widgets/task_tile.dart`, new `lib/widgets/shared/mindful_completion_screen.dart`
**What:** On task completion: 1-2 second pause showing task's motivation/reward before confetti animation. Creates moment of genuine satisfaction, prevents task-checking addiction loop.
**Why:** Slows dopamine rush to reinforce "why" behind the task. Connects daily wins to long-term values.
**Use /implement WB-2**

### WB-5: Celebration Intensity Settings
**Files:** `lib/widgets/shared/celebration_overlay.dart`, `lib/screens/dashboard_screen.dart`, `lib/screens/settings_screen.dart`
**What:** Add a "Celebration Preferences" setting with 3 levels: "Enthusiastic" (current full overlays), "Mindful" (reduced — sound only after 3rd task), "Silent" (badge only). Throttle full celebrations to max 1 per 15 minutes per type. Agent found `dashboard_screen.dart:566` fires overlay on EVERY completion with no throttle.
**Why:** After 10+ completions in a session, celebrations become noise (celebration fatigue). Preserves joy by being selective, not omnipresent. Also respects neurodiversity — ADHD/anxiety users may find constant overlays disruptive.
**Use /implement WB-5**

### WB-6: Adaptive Progress Visualization
**Files:** `lib/providers/stats_provider.dart`, `lib/screens/wellness_catalog_screen.dart`, `lib/screens/dashboard_screen.dart`
**What:** Replace raw % with contextual progress messages. Instead of "10% explorado" show "Descubriste 1 de 6 categorías". Track user's 4-week average completion rate and use it as personal baseline (shown as 100%), so a 55% week reads as "87% de tu promedio" not a failing grade.
**Why:** Raw numbers demoralize when percentages feel tiny. Agent found `stats_provider.dart:62-97` exposes percentages without personal context. Users need relative progress, not absolute metrics.
**Use /implement WB-6**

### A11Y-2: Minimum Touch Target Sizes
**Files:** `lib/widgets/dialogs/add_task_dialog.dart`, `lib/widgets/task_tile.dart`, `lib/widgets/task_list.dart`
**What:** Wrap small icon buttons (18px close icons in date pickers) in 48x48 `SizedBox`. Increase checkbox scale from 1.2x to 1.5x. Add `materialTapTargetSize: MaterialTapTargetSize.padded` to filter chips.
**Why:** Material Design minimum is 48x48dp. Current close icons (18px) and filter chip avatars fail accessibility standards (WCAG 2.5.5).
**Use /implement A11Y-2**

### A11Y-3: Reduce Motion Support
**Files:** `lib/main.dart`, `lib/widgets/task_tile.dart`, `lib/widgets/shared/celebration_overlay.dart`
**What:** Check `MediaQuery.of(context).disableAnimations` before running celebration animations and haptic feedback.
**Why:** Users with vestibular disorders or epilepsy need motion reduction support.
**Use /implement A11Y-3**

### CODE-5: Consolidate Duplicate Provider Architecture
**Files:** `lib/providers/task_provider.dart`, `lib/providers/task_providers.dart`
**What:** The app has two competing task-fetch systems: `tasksProvider` (StateNotifier with deduplication) and `tasksByTypeProvider` (StreamProvider, bypasses deduplication). Deprecate `tasksByTypeProvider` and route all consumers through `TaskNotifier`. Move deduplication to `HiveTaskStorage` as single source of truth.
**Why:** Agent found parallel deduplication logic causing potential inconsistency. Dashboard manually aggregates all 5 types (`dashboard_screen.dart:591-595`). Two data paths = double maintenance burden + data sync bugs.
**Use /implement CODE-5**

### CODE-6: Composite `dailyStatsProvider` for Performance
**Files:** `lib/widgets/task_tile.dart`, `lib/screens/dashboard_screen.dart`
**What:** Create a `dailyStatsProvider` that computes completed count, allCompleted bool, and category set in a single pass. Use `.select()` in dashboard widgets to watch only needed fields. Replace the 5 separate `ref.watch(tasksProvider(...))` calls in `_UpcomingDeadlinesCard`.
**Why:** Agent found `task_tile.dart:94-149` reads task provider 5 separate times for achievement checks. Dashboard `_UpcomingDeadlinesCard` watches all 5 task types — a single task completion triggers full card rebuild. Using `.select()` reduces rebuilds by ~60%.
**Use /implement CODE-6**

---

## Major Features

Multi-day implementations. Strategic improvements to the product.

### PROD-2: Push Notifications & Deadline Escalation
**What:** Local notifications for deadlines: 1 week before (gentle), 1 day before (prominent), 2 hours before (urgent). Add `flutter_local_notifications` package. Visual urgency escalation (overdue tasks surface to top with red indicator).
**Why:** The `deadline` field exists but has no enforcement. Users miss deadlines because they don't see reminders.
**Use /implement PROD-2**

### PROD-3: Batch Operations
**What:** Multi-select mode in TaskList. Long-press to enter selection mode. Batch: change priority, reassign category, extend deadlines, mark complete, delete. Smart presets: "Select all overdue + high priority."
**Why:** Moving or updating groups of tasks (e.g., reorganizing a project) currently requires N individual edits.
**Use /implement PROD-3**

### PROD-4: Task Templates
**What:** Save completed tasks as templates. Template library with presets (Sprint Planning, Home Maintenance, Health Check-in). Apply template to instantly create a task with pre-filled priority/category/motivation/reward.
**Why:** Power users recreate the same task structures weekly. Templates eliminate decision fatigue for recurring workflows.
**Use /implement PROD-4**

### PROD-5: Voice & Natural Language Task Input
**What:** Integrate `speech_to_text` package. Add a microphone button to `AddTaskDialog`. Parse natural language phrases ("llama a mamá mañana a las 3pm") to auto-fill title, due date, and due time. Fallback to manual entry if parsing fails.
**Why:** No voice capture exists. Mobile users on-the-go have 3x faster capture with voice. The task creation form (`add_task_dialog.dart`) has all fields but no voice entry point.
**Use /implement PROD-5**

### PROD-6: Task Subtasks / Nested Checklists
**What:** Add `subtasks: List<Subtask>` to the `Task` model. Show subtask progress on the tile ("3/5 subtareas"). Allow blocking task completion until all subtasks are done (optional). TaskTile expansion reveals subtask list inline.
**Why:** The `Note` model has `ChecklistItem` but these are detached from tasks. Users with multi-step workflows (sprint retros, home projects) have no way to structure tasks into steps.
**Use /implement PROD-6**

### PROD-7: Quick Capture Home Screen Widget
**What:** Add Android/iOS home screen widget using `home_widget` package. Widget shows top 3 today's urgent tasks + a one-tap add button that opens a quick-capture overlay. Background Dart execution saves directly to Hive.
**Why:** Users must fully open the app → tap FAB → fill form to create a task (~30s). A widget reduces capture to <5s and increases daily engagement rate.
**Use /implement PROD-7**

### WB-3: Daily Capacity Indicator
**Files:** New `lib/widgets/dashboard/capacity_indicator_card.dart`, `lib/screens/dashboard_screen.dart`
**What:** Based on 14-day completion history, calculate sustainable daily task count. Show indicator: "Buen ritmo (2-3 tareas)" or "¡Atención! (7+ tareas, riesgo de agotamiento)".
**Why:** Prevents anxiety-inducing overload. Users feel accomplished with realistic goals rather than stressed by impossible lists.
**Use /implement WB-3**

### WB-4: Weekly Reflection Screen
**Files:** New `lib/screens/weekly_reflection_screen.dart`, trigger in `lib/providers/day_cycle_provider.dart`
**What:** Sunday prompt showing week's completion rate, streaks, wellness activities tried. Reflection prompts (optional notes). If >80% completion for 4+ weeks: gentle nudge to ease up and rest.
**Why:** Breaks the "always running" mentality. Guided reflection creates self-compassion, not just metrics.
**Use /implement WB-4**

### WB-7: Workload Radar + Overwhelm Detection
**Files:** `lib/screens/dashboard_screen.dart`, `lib/widgets/dashboard/wellness_suggestions_card.dart`
**What:** Calculate total daily recommended items (all task types + wellness suggestions). Show a color-coded indicator: Green (3-8, healthy), Yellow (8-15, consolidate), Red (15+, defer non-urgent). When over 15: auto-hide wellness suggestions, prompt "¿Quieres diferir las tareas de Bienestar?" Smart deferral moves oldest uncompleted low-priority tasks to tomorrow.
**Why:** Agent found `wellness_suggestions_card.dart:66-118` generates 6 suggestions with no capacity check. A user with 8 daily + 5 weekly + 6 wellness = 19 "suggested" items. No system warns or helps manage this. Extends WB-3's indicator with active intervention.
**Use /implement WB-7**

### WB-8: Evening Reflection Card
**Files:** `lib/providers/day_cycle_provider.dart`, new `lib/widgets/dashboard/evening_reflection_card.dart`
**What:** Show a card at 19:00-20:00 (dismissable): summary of today's completions, top 3 wins (with motivation text), tomorrow's highest-priority tasks, guide reaction. Optional single-line gratitude capture ("Lo que lograste hoy...").
**Why:** `guide_farewell_widget.dart:220-225` shows only a 5-second generic goodnight — no reflection of actual progress. Users complete tasks but never review wins before tomorrow. Evening ritual creates closure, reduces rumination, and builds positive memory of effort.
**Use /implement WB-8**

### A11Y-4: Dynamic Text Scaling Support
**Files:** `lib/main.dart`, all widget files
**What:** Replace hardcoded `fontSize:` with `Theme.of(context).textTheme` styles. Add `builder:` in MaterialApp to respect system text size settings. Fix `app_drawer.dart:338-344` header title which uses hardcoded `fontSize: 22` causing overflow at large text scales.
**Why:** 15-20% of users increase text size in accessibility settings. Fixed sizes cause overflow/truncation. Agent confirmed drawer header and several widget sizes are hardcoded (WCAG 1.4.4).
**Use /implement A11Y-4**

---

## Recommended Next Steps

All Quick Wins from 2026-02-15 are complete. Next priorities:

1. **UX-4 (Undo completion)** — Symmetry with UX-1. 1 hour, eliminates a frustrating UX gap.
2. **CODE-3 (Streak race condition)** — Prevents subtle bugs; 30 min fix.
3. **UX-6 (Progressive form)** — Most-impactful UX change for new users; cuts cognitive load on task creation.
4. **WB-5 (Celebration settings)** — Prevents celebration fatigue for daily users.
5. **CODE-5 (Consolidate providers)** — Architectural cleanup that simplifies future work.
6. **PROD-2 (Notifications)** — Highest-value major feature; deadlines exist but are unenforced.

---

## How to Implement

Use the `/implement` skill with the ID of any improvement:

```
/implement UX-4
/implement CODE-3
/implement UX-6
```

Each implementation is atomic and won't break existing functionality.
